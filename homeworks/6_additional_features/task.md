# 6. Дополнительные возможности Terraform

- [6. Дополнительные возможности Terraform](#6-дополнительные-возможности-terraform)
- [Получение данных из облака](#получение-данных-из-облака)
  - [Задание](#задание)
- [Установка пакетов на вм с помощью remote-exec](#установка-пакетов-на-вм-с-помощью-remote-exec)
  - [Задание](#задание-1)
- [Интеграция Ansible и Terraform](#интеграция-ansible-и-terraform)
  - [Задание](#задание-2)

Получение данных из облака
=======

Задание
-------

`Datasource` - это способ получить информацию об объектах уже существующих в облаке. Повторите то, что было показано в видео, дайте возможность пользователю указывать образ для виртуальных по имени. Это более удобный способ работы с образами, не требующий знания длинного ID.

1. Добавьте в файл `main.tf` датасурс `yandex_compute_image` с поиском по `family` образа

2. Поле `family` принимается из переменной `vm_image`

3. Как обычно проверьте работу конфигурации с вариантами значений `centos-7` и `ubuntu-2004-lts`

4. После завершения задания удалите инфраструктуру

Установка пакетов на вм с помощью remote-exec
=======

Задание
-------

Попробуем использование `remote-exec` провиженера. В некоторых случаях, он может быть удобен для установки необходимых пакетов перед запуском основного провиженинга. Например когда используется `Ansible`, на виртуальной машине должен быть установлен `Python`.

1. Добавьте в конфигурацию виртуальных машин `remote-exec` с `inline` скриптом, чтобы обновить все пакеты и выполнить команды `ping` с тремя запросами для проверки работоспособности сети.

2. Примените конфигурацию, проверьте корректность работы скрипта.

3. После завершения задания удалите конфигурацию.

Интеграция Ansible и Terraform
=======

Задание
-------

В этом задании попробуем на практике запуск `Ansible` с помощью `local-exec` в `Terraform`. Этот способ подходит так же для запуска любых систем `configuration-management` или локальных скриптов.

1. Скопируйте в свой проект диретокрию `6.additional_features/ansible` из репозитория с практиками.

2. Добавьте в конфигурацию виртуальной машины блок с `local-exec` и вызовом `Ansible`.

3. Примените конфигурацию. Проверьте что `Ansible` отработал корректно. В нашем проекте есть балансировщик, сконфигурируйте его для проксирования трафика на 80 порт виртуальных машин. Проверьте через IP балансировщика, что вы видите ответы от `Nginx` с виртуальной машины.

4. После выполнения задания удалите созданную инфраструктуру
